<form
    x-data="{
        product: JSON.parse('<%= JSON.stringify(product) %>'),
        isWishlist: JSON.parse('<%= JSON.stringify(isWishlist) %>')
    }"
    id="add-to-cart-form">

    <div class="container mx-auto px-4 py-8">
        <!-- Back Button -->
        <a @click="history.back()" class="mb-4 cursor-pointer w-40 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 flex items-center">
            ◀ Back
        </a>

        <!-- Toast Messages -->
        <div class="absolute top-10 right-10">
            <%- include("../../partials/organisms/toastMsg.ejs") %>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Product Gallery -->
            <div>
                <div class="relative group">
                    <img 
                        src="<%= product.images.cardImage.path %>" 
                        alt="<%= product.productName %>"
                        class="w-full h-96 object-cover rounded-lg shadow-lg main-image transition-transform duration-300 ease-in-out group-hover:scale-110"
                    >
                </div>
                <div class="flex mt-4 space-x-2">
                    <% product.images.productImages.forEach(img => { %>
                        <img 
                            src="<%= img.path %>" 
                            class="w-20 h-20 object-cover rounded-lg cursor-pointer border border-gray-300 hover:border-blue-500"
                            onclick="changeImage('<%= img.path %>')"
                        >
                    <% }); %>
                </div>
            </div>

            <!-- Product Details -->
            <div class="space-y-4">
                <!-- Product Name -->
                <h1 class="text-3xl font-bold text-gray-800">
                    <%= product.productName %>
                </h1>

                <!-- Product Rating -->
                <p class="text-yellow-500 font-medium">
                    ⭐ <strong><%= product.rating || "4.8" %></strong> | 67 Reviews
                </p>

                <!-- Product Description -->
                <p class="text-gray-600">
                    <%= product.description %>
                </p>

                <!-- Product Offer Section -->
                <% if (productOffer) { %>
                    <div class="bg-green-50 border border-green-500 text-green-800 p-4 rounded-lg mb-4">
                        <h3 class="text-lg font-bold">Special Offer</h3>
                        <p class="text-sm">
                            Get <%= productOffer.discountPercentage %>% off! Offer valid until 
                            <strong><%= new Date(productOffer.endDate).toLocaleDateString() %></strong>.
                        </p>
                    </div>
                <% } %>

                <!-- Hidden Product ID -->
                <input type="hidden" name="productId" value="<%- product._id %>">

                <!-- Error Message Box -->
                <div id="error-box" class="p-4 mb-4 hidden text-sm text-red-800 rounded-lg bg-red-50 dark:text-red-400"></div>

                <% if (product.quantity) { %>
                    <!-- Quantity Selector -->
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">Quantity:</label>
                        <div class="flex items-center space-x-2">
                            <button 
                                onclick="updateQuantity(-1, event)" 
                                class="px-3 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400"
                            >
                                -
                            </button>
                            <input 
                                name="quantity" 
                                type="text" 
                                id="quantity" 
                                value="1" 
                                class="w-12 text-center border border-gray-300 rounded-lg"
                            >
                            <button 
                                onclick="updateQuantity(1, event)" 
                                class="px-3 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400"
                            >
                                +
                            </button>
                        </div>
                    </div>

                    <!-- Pricing Section -->
                    <div>
                        <% if (productOffer) { %>
                            <h2 class="text-2xl font-bold text-blue-500" id="sellingPrice">
                                ₹<%= (product.price.originalPrice - (product.price.originalPrice * productOffer.discountPercentage) / 100).toFixed(2) %>
                            </h2>
                            <span class="text-gray-500 line-through" id="originalPrice">
                                ₹<%= product.price.originalPrice %>
                            </span>
                            <span class="text-green-600 font-semibold ml-2" id="saveAmount">
                                Save ₹<%= ((product.price.originalPrice * productOffer.discountPercentage) / 100).toFixed(2) %>
                            </span>
                        <% } else { %>
                            <h2 class="text-2xl font-bold text-blue-500" id="sellingPrice">
                                ₹<%= product.price.sellingPrice %>
                            </h2>
                            <span class="text-gray-500 line-through" id="originalPrice">
                                ₹<%= product.price.originalPrice %>
                            </span>
                            <span class="text-green-600 font-semibold ml-2" id="saveAmount">
                                Save ₹<%= product.price.originalPrice - product.price.sellingPrice %>
                            </span>
                        <% } %>
                    </div>

                    <!-- Wishlist and Add to Cart Buttons -->
                    <div class="flex items-center gap-x-4">
                        <button
                        type="submit"
                        class="w-full cursor-pointer py-3 text-center bg-blue-500 text-white font-semibold rounded-lg shadow-md hover:bg-blue-600"
                        >
                        <i class="fa-solid fa-cart-shopping mr-2"></i> Add To Cart
                    </button>
                    <button class="cursor-pointer" >
                        <i
                         :data-product-id="product._id"
                         :class="{'text-red-500': isWishlist}"
                         class="wishlist-btn fa-solid fa-heart fa-2xl text-gray-400 hover:scale-110 transition-all"></i>
                    </button>
                    </div>
                <% } else { %>
                    <!-- Out of Stock Message -->
                    <p class="bg-red-50 py-2 text-red-800 border text-center rounded-lg border-red-500 font-medium">
                        Out of Stock
                    </p>
                <% } %>
            </div>
        </div>
    </div>
</form>

<!-- Scripts -->
<script type="module" src="/javascript/ajax/pages/userProduct.js"></script>
<script type="module" src="/javascript/ajax/products/product.js"></script>