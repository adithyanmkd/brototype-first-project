<div class="container mx-auto px-4 py-8">
    <!-- Header -->
    <div class="flex justify-between items-center mb-8">
      <h1 class="text-2xl font-bold text-gray-900">Orders</h1>
    </div>

    <div class="flex justify-between">
      <!-- Search Bar -->
      <div  class="relative mb-10">
      <svg xmlns="http://www.w3.org/2000/svg" class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
      <input
        id="searchField"
        type="text"
        placeholder="Search orders..."
        class="pl-10 pr-4 py-2 w-full md:w-64 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
      />
      <a  href="/admin/orders?search=" class="px-4 pr-4 py-2 bg-blue-50 border border-blue-400 hover:bg-blue-100 text-blue-600 font-semibold rounded-[8px]">clear</a>
      </div>

     <!-- Status Filter Dropdown -->
      <div x-data="{ open: false, selectedStatus: 'All', statuses: ['All', 'Pending', 'Confirmed', 'Shipped', 'Delivered', 'Cancelled', 'Return Requested', 'Return Rejected', 'Returned'],
          init() {
            const params = new URLSearchParams(window.location.search);
            const status = params.get('category');
            if (status && this.statuses.includes(status)) {
                this.selectedStatus = status;
            }
          }
       }"
      class="relative">
        <!-- Button -->
        <button
            @click="open = !open"
            class="w-full md:w-48 flex items-center justify-between px-4 py-2 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
        >
            <span class="text-gray-700" x-text="selectedStatus"></span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
        </button>

        <!-- Dropdown Menu -->
        <div x-show="open" @click.away="open = false" class="absolute z-10 w-full mt-2 bg-white border border-gray-300 rounded-lg shadow-lg">
            <template x-for="status in statuses" :key="status">
                <button 
                    class="status-item w-full px-4 py-2 text-left hover:bg-gray-50 first:rounded-t-lg last:rounded-b-lg"
                    @click="selectedStatus = status; open = false"
                    :value="status"
                    x-text="status">
                </button>
            </template>
        </div>
      </div>
    </div>


    <!-- Table -->
    <div class="bg-white rounded-lg shadow overflow-hidden">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Order Id</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Customers</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <% orders.forEach((order) => { %>
            <tr>
              <td class="px-6 py-4 whitespace-nowrap">
                <a href="/admin/orders/<%= order._id %>">
                  <span class="text-indigo-600 font-medium">#<%= order.orderId %></span>
                </a>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                <%= new Date(order.orderDate).toLocaleDateString("en-US", {
                  month: "short",
                  day: "2-digit",
                  year: "numeric"
                }) %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center">
                  <div class="h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-600">
                    <img class="rounded-full" src="<%= order.user.profilePic %>" alt="avatar">
                  </div>
                  <div class="ml-4">
                    <div class="text-sm font-medium text-gray-900"><%= order.user.name %></div>
                    <div class="text-sm text-gray-500"><%= order.user.email %></div>
                  </div>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div x-data="{ status: '<%= order.orderStatus %>' }" class="flex items-center space-x-2">
                    <span
                      :class="{
                        'bg-yellow-100 text-yellow-800': status === 'Pending',
                        'text-indigo-600 bg-indigo-50' : status === 'Confirmed',
                        'bg-purple-100 text-purple-500' : status === 'Shipped',
                        'bg-green-50 text-green-600': status === 'Delivered',
                        'bg-red-50 text-red-600 ': status === 'Cancelled',
                        'bg-orange-50 text-orange-600': status === 'Return Requested',
                        'bg-red-50 text-red-600': status === 'Return Rejected',
                        'bg-green-50 text-green-600 ': status === 'Returned'
                      }" 
                      class="px-3 py-1 rounded-full text-sm font-medium"
                      ><%= order.orderStatus %></span
                    >
                </div>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
      <div class="flex justify-center space-x-2 mt-4">
        <% if (page> 1) { %>
            <a href="/admin/orders?page=<%= page - 1 %>"
                class="px-3 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Previous</a>
            <% } %>

                <% for (let i=1; i <=totalPages; i++) { %>
                    <a href="/admin/orders?page=<%= i %>"
                        class="px-3 py-2 rounded-lg <%= page === i ? 'bg-blue-500 text-white' : 'bg-gray-200 hover:bg-gray-300' %>">
                        <%= i %>
                    </a>
                    <% } %>

                        <% if (page < totalPages) { %>
                            <a href="/admin/orders?page=<%= page + 1 %>"
                                class="px-3 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Next</a>
                            <% } %>
    </div>
    </div>
  </div>

  <script type="module" src="/javascript/ajax/pages/adminOrders.js"></script>
